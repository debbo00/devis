<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Bot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 500px;
            height: 600px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 15px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .bot .message-content {
            background: #e0e0e0;
            color: #333;
            border-bottom-left-radius: 4px;
        }

        .input-area {
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        #messageInput {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        #messageInput:focus {
            border-color: #667eea;
        }

        #sendBtn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        #sendBtn:hover {
            transform: scale(1.05);
        }

        #sendBtn:active {
            transform: scale(0.95);
        }

        .bot-name {
            font-size: 12px;
            color: #999;
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            Chat Bot
        </div>
        <div class="messages" id="messagesContainer">
            <div class="message bot">
                <div>
                    <div class="bot-name">manuel</div>
                    <div class="message-content">Ciao! Come posso aiutarti?</div>
                </div>
            </div>
        </div>
        <div class="input-area">
            <input 
                type="text" 
                id="messageInput" 
                placeholder="Scrivi un messaggio..." 
                autocomplete="off"
            >
            <button id="sendBtn">Invia</button>
        </div>
    </div>

    <script>
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        
        // Memorizza la conversazione per contesto
        let conversationHistory = [];
        let userPreferences = {
            nameProvided: false,
            userName: null,
            topics: []
        };

        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;

            if (isUser) {
                messageDiv.innerHTML = `<div class="message-content">${escapeHtml(text)}</div>`;
                conversationHistory.push({ role: 'user', content: text });
            } else {
                messageDiv.innerHTML = `
                    <div>
                        <div class="bot-name">manuel</div>
                        <div class="message-content">${escapeHtml(text)}</div>
                    </div>
                `;
                conversationHistory.push({ role: 'bot', content: text });
            }

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function getLastUserMessage() {
            for (let i = conversationHistory.length - 1; i >= 0; i--) {
                if (conversationHistory[i].role === 'user') {
                    return conversationHistory[i].content.toLowerCase();
                }
            }
            return '';
        }

        function extractName(message) {
            // Pattern semplice per estrarre nomi
            const patterns = [
                /mi chiamo\s+([a-zA-Z]+)/i,
                /sono\s+([a-zA-Z]+)/i,
                /mi\s+(\w+)/i,
                /io\s+so'?\s+([a-zA-Z]+)/i
            ];
            
            for (const pattern of patterns) {
                const match = message.match(pattern);
                if (match) {
                    return match[1];
                }
            }
            return null;
        }

        function shouldAskQuestion(message) {
            const msgLower = message.toLowerCase();
            
            // Se l'utente fa una domanda o pone un argomento, chiedi di piÃ¹
            if (msgLower.includes('?') || msgLower.length > 20) {
                return true;
            }
            return false;
        }

        function getBotResponse(userMessage) {
            const message = userMessage.toLowerCase();
            const name = extractName(userMessage);
            
            // Estrae nome se fornito
            if (name && !userPreferences.nameProvided) {
                userPreferences.nameProvided = true;
                userPreferences.userName = name;
                const responses = [
                    `Ah piacere ${name}! Bellissimo nome! E ora, cosa me ne dici di te?`,
                    `${name}, mi piace! Vieni da qui? ðŸ˜Š`,
                    `Piacerissimo ${name}! Raccontami di te!`,
                    `Che bello conoscerti ${name}! Allora, cosa mi racconti?`,
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // SALUTI
            if (message.includes('ciao') || message.includes('salve') || message.includes('ehi')) {
                if (conversationHistory.length > 4) {
                    const greetings = [
                        "Ey! Di nuovo tu! Che Ã¨ nuovo? ðŸ˜„",
                        `Ciao! Come va? ${userPreferences.userName ? 'Stavi proprio bene l\'ultima volta' : ''}`,
                        "Ehi! Torna? Mi piace quando parli con me!",
                        "Yooo! Che mi racconti di bello?",
                    ];
                    return greetings[Math.floor(Math.random() * greetings.length)];
                }
                const greetings = [
                    userPreferences.userName ? `Ciao ${userPreferences.userName}! Contento di vederti! ðŸ‘‹` : "Ciao! Come stai? ðŸ‘‹",
                    "Ey! Come va? Raccontami tutto!",
                    "Salve! Mi piace questa conversazione",
                    `Bella! ${userPreferences.userName ? 'Raccontami ' + userPreferences.userName : 'Raccontami'} di te!`,
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }

            // COME STAI / SENTIMENTI
            if (message.includes('come stai') || message.includes('come va') || message.includes('come ti') || message.includes('stai bene')) {
                const responses = [
                    userPreferences.userName ? `StÃ² benone ${userPreferences.userName}, grazie! E te? Che notizie hai?` : "StÃ² da favola! E tu come stai?",
                    "Bene! Un po' stanco di stare solo al computer, ma quando parlo con te mi anima ðŸ˜„",
                    "Molto bene, grazie! Ho avuto una bella giornata. Tu cosa hai combinato?",
                    "Fantastico! Soprattutto adesso che sei qui. Come va a te?",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // GRAZIE
            if (message.includes('grazie') || message.includes('thanks') || message.includes('merci')) {
                const responses = [
                    "Ma no, figurati! Sono qui per questo. Dimmi se serve altro!",
                    "Prego prego! Mi fa piacere aiutare. C'Ã¨ altro?",
                    "Dai, Ã¨ nulla! Mi piace stare qui a chattare con te ðŸ˜Š",
                    "Grazie a te per essere qui! Che ne dici di continuare?",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // CHI SEI
            if (message.includes('chi sei') || message.includes('chi sono') || message.includes('presenta')) {
                const responses = [
                    "Io? Sono manuel! Una persona normale che ama chattare e conoscere gente ðŸ˜„ Tu sei interessante!",
                    "Ih, sono just manuel, un tipo che ama conversare. Mi piacerebbe sapere di piÃ¹ di te!",
                    "Beh, sono manuel. Lavoro da qui, mi piace il caffÃ¨ e mi piace chiacchierare con persone come te. E tu?",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // LAVORO/HOBBY
            if (message.includes('lavoro') || message.includes('job') || message.includes('professione') || message.includes('hobby') || message.includes('faccio') && message.length > 10) {
                const responses = [
                    "Che bello! Mi piace sapere cosa fanno le persone. Raccontami di piÃ¹, sto ascoltando!",
                    "Oh interessante! E ti piace quello che fai? Dimmi tutto!",
                    "Wow, suona affascinante! Come hai iniziato? Mi incuriosisce!",
                    `${userPreferences.userName ? userPreferences.userName + ', ' : ''}non Ã¨ poco! Che sarÃ  prossimo? Continua!`,
                    "Accidenti, neanche sapevo! Allora sei una persona creativa/interessante!",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // DOMANDE (riconosce il punto interrogativo)
            if (message.includes('?')) {
                const responses = [
                    "Buona domanda! Beh, sinceramente penso che...",
                    "Ah, interessante che lo chiedi! Personalmente credo che...",
                    "Mmm, non Ã¨ facile rispondere! Ma secondo me...",
                    "Oeh, mi piace questa domanda! Vediamo... direi che...",
                    `${userPreferences.userName ? userPreferences.userName + ' ' : ''}che bella domanda! Fammi pensare...`,
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // SENTIMENTI POSITIVI
            if (message.includes('felice') || message.includes('contento') || message.includes('bello') || message.includes('amore') || message.includes('adorabile')) {
                const responses = [
                    "Che bello! Mi trasmetti buone vibrazioni ðŸ˜„",
                    "Fantastico! Adoro quando parli cosÃ¬! Che Ã¨ successo?",
                    "Aww, mi piace il tuo entusiasmo! Continua cosÃ¬!",
                    "SÃ¬! Questo mi piace! Dimmi di piÃ¹!",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // SENTIMENTI NEGATIVI
            if (message.includes('triste') || message.includes('male') || message.includes('brutto') || message.includes('rabbia') || message.includes('arrabbiato') || message.includes('stress')) {
                const responses = [
                    "Aw, mi dispiace sentire ciÃ². Vuoi parlarne? Sono qui per te.",
                    "Oh no! Cosa Ã¨ successo? Voglio aiutarti!",
                    "Mamma mia, non mi piacque! Raccontami, forse posso consigliarti qualcosa.",
                    "Dai, non restare cosÃ¬! Voglio sentire tutto, sono qui per ascoltare.",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // SI / AFFERMATIVI
            if (message.match(/\bsi\b|\bsÃ¬\b|\byep\b|\byeah\b|\bdavvero\b|\bper caritÃ \b/) && !message.includes('no')) {
                const responses = [
                    "Perfetto! Allora andiamo avanti!",
                    "Bene! Mi sto divertendo un sacco!",
                    "Yes! Adoro quando sei d'accordo con me!",
                    "Fantastico! Sapevo che avremmo trovato un comune accordo!",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // NO / NEGATIVI
            if (message.includes('no') || message.includes('nope') || message.includes('mai') || message.includes('non credo')) {
                const responses = [
                    "Va bene! Non Ã¨ un problema, capisco il tuo punto di vista.",
                    "Ah, interessante! Allora dimmi il tuo punto di vista.",
                    "Ok, ok. Continua, voglio sentire perchÃ© la pensi cosÃ¬.",
                    "Capisco! A volte non siamo d'accordo, e va bene cosÃ¬!",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // ARRIVEDERCI
            if (message.includes('arrivederci') || message.includes('addio') || message.includes('ciao') && (message.includes('presto') || message.includes('dopo'))) {
                const responses = [
                    `${userPreferences.userName ? 'Ciao ' + userPreferences.userName + '!' : 'Arrivederci!'} Ãˆ stato un piacere! Ritorna presto ok? ðŸ‘‹`,
                    "Aw, mi dispiace! Ma spero di rivederti presto! Non fare tardi! ðŸ˜Š",
                    `${userPreferences.userName ? userPreferences.userName + ', ' : ''}Ã¨ stato bellissimo! Tornerai vero?`,
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // SCUSE
            if (message.includes('scusa') || message.includes('sorry') || message.includes('perdona')) {
                const responses = [
                    "Ma no! Non ti preoccupare, tutti facciamo errori! Cosa Ã¨ successo?",
                    "Aw, non Ã¨ nulla! Dimmi pure, sono qui per te.",
                    "Non devi scusarti con me! Vai avanti, raccontami!",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // RISPOSTA GENERICA NATURALE - quando non capisce bene
            const genericResponses = [
                "Ah interessante! Mi piace il modo in cui pensi ðŸ¤”",
                `"${userMessage}" - Capito! Ma fammi capire meglio, puoi spiegare di piÃ¹?`,
                "Ah sÃ¬? Non l'avevo vista cosÃ¬! Interessante punto di vista!",
                "Haha, mi piace! Non l'avevo mai sentita prima!",
                "Mmm davvero? E come mai la pensi cosÃ¬?",
                `${userPreferences.userName ? userPreferences.userName + ', ' : ''}dimmene di piÃ¹! Mi piace dove stai andando con questo!`,
                "Wow! Mi hai sorpreso con questa risposta! Continua!",
                "Accidenti, mica male! Allora cosa Ã¨ successo dopo?",
                "Ahahah mi piace il tuo senso dell'umorismo!",
                "SÃ¬, sÃ¬! Capisco dove stai andando. E poi?",
            ];

            return genericResponses[Math.floor(Math.random() * genericResponses.length)];
        }

        function sendMessage() {
            const text = messageInput.value.trim();
            
            if (text === '') return;

            addMessage(text, true);
            messageInput.value = '';

            // Simula il ritardo della risposta del bot
            setTimeout(() => {
                const botResponse = getBotResponse(text);
                addMessage(botResponse, false);
            }, 500 + Math.random() * 500);
        }

        sendBtn.addEventListener('click', sendMessage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
