<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Bot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 500px;
            height: 600px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 15px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .bot .message-content {
            background: #e0e0e0;
            color: #333;
            border-bottom-left-radius: 4px;
        }

        .input-area {
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        #messageInput {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        #messageInput:focus {
            border-color: #667eea;
        }

        #sendBtn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        #sendBtn:hover {
            transform: scale(1.05);
        }

        #sendBtn:active {
            transform: scale(0.95);
        }

        .bot-name {
            font-size: 12px;
            color: #999;
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            Chat Bot
        </div>
        <div class="messages" id="messagesContainer">
            <div class="message bot">
                <div>
                    <div class="bot-name">manuel</div>
                    <div class="message-content">Ciao! Come posso aiutarti?</div>
                </div>
            </div>
        </div>
        <div class="input-area">
            <input 
                type="text" 
                id="messageInput" 
                placeholder="Scrivi un messaggio..." 
                autocomplete="off"
            >
            <button id="sendBtn">Invia</button>
        </div>
    </div>

    <script>
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        
        // Memoria della conversazione
        let conversationHistory = [];
        let userProfile = {
            nameProvided: false,
            userName: null,
            topic: null,
            previousTopics: [],
            emotionalState: null,
            jobInfo: null,
            interests: []
        };
        let messageCount = 0;

        function addMessage(text, isUser) {
            messageCount++;
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;

            if (isUser) {
                messageDiv.innerHTML = `<div class="message-content">${escapeHtml(text)}</div>`;
                conversationHistory.push({ role: 'user', content: text });
            } else {
                messageDiv.innerHTML = `
                    <div>
                        <div class="bot-name">manuel</div>
                        <div class="message-content">${escapeHtml(text)}</div>
                    </div>
                `;
                conversationHistory.push({ role: 'bot', content: text });
            }

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function getRecentMessages(count = 3) {
            return conversationHistory.slice(-count * 2).filter(m => m.role === 'user').map(m => m.content.toLowerCase());
        }

        function extractTopic(message) {
            const msg = message.toLowerCase();
            if (msg.includes('programm') || msg.includes('code') || msg.includes('svilupp')) return 'programming';
            if (msg.includes('lavoro') || msg.includes('job') || msg.includes('lavori')) return 'work';
            if (msg.includes('musica') || msg.includes('canto') || msg.includes('ascolt')) return 'music';
            if (msg.includes('sport') || msg.includes('palestra') || msg.includes('calcio') || msg.includes('corsa')) return 'sport';
            if (msg.includes('libro') || msg.includes('leggi') || msg.includes('lettur')) return 'reading';
            if (msg.includes('film') || msg.includes('serie') || msg.includes('netflix')) return 'movies';
            if (msg.includes('travel') || msg.includes('viaggio') || msg.includes('mondo')) return 'travel';
            if (msg.includes('cucina') || msg.includes('mangia') || msg.includes('ricett')) return 'cooking';
            if (msg.includes('amico') || msg.includes('amica') || msg.includes('relazion')) return 'relationships';
            return null;
        }

        function extractName(message) {
            const patterns = [
                /mi chiamo\s+([a-zA-Z]+)/i,
                /sono\s+([a-zA-Z]+)/i,
                /mi\s+(\w+)/i,
                /re\b/i,
            ];
            for (const pattern of patterns) {
                const match = message.match(pattern);
                if (match) {
                    return match[1] || "RE";
                }
            }
            return null;
        }

        function buildContextualResponse(userMessage) {
            const message = userMessage.toLowerCase();
            const recentMsgs = getRecentMessages(2);
            const topic = extractTopic(userMessage);
            
            // Traccia argomenti
            if (topic && topic !== userProfile.topic) {
                userProfile.previousTopics.push(userProfile.topic);
                userProfile.topic = topic;
            }

            // Se Ã¨ di nuovo lo stesso argomento, approfondisci
            if (topic === userProfile.topic && topic !== null) {
                const deeperQuestions = {
                    programming: [
                        "Allora spiegami, in che linguaggio lavori principalmente?",
                        "Che tipo di progetti ti piacciono di piÃ¹?",
                        "Quanto tempo che programmi ormai?",
                        "Qual Ã¨ il linguaggio che detesti di piÃ¹? ðŸ˜„",
                    ],
                    work: [
                        "Quanto tempo che fai questo lavoro?",
                        "Cosa ti piace di piÃ¹ di quello che fai?",
                        "Ti stai specializzando in altro?",
                        "Come vedrai il tuo futuro lavorativo?",
                    ],
                    music: [
                        "Che genere ascolti principalmente?",
                        "Suoni qualche strumento?",
                        "Chi Ã¨ il tuo artista preferito?",
                        "Vai a concerti?",
                    ],
                    sport: [
                        "Pratichi solo questo o altri sport?",
                        "Da quanto tempo lo pratichi?",
                        "Sei piÃ¹ per il cardio o la forza?",
                        "Quale Ã¨ il tuo risultato migliore?",
                    ],
                };
                if (deeperQuestions[topic]) {
                    return deeperQuestions[topic][Math.floor(Math.random() * deeperQuestions[topic].length)];
                }
            }

            // Se cambia argomento, commenta il precedente
            if (topic && topic !== userProfile.topic && userProfile.topic) {
                const transitionResponses = [
                    `Interessante! Allora oltre a ${userProfile.topic}, ami anche ${topic}! Raccontami di piÃ¹ su questo.`,
                    `Oh! Cambio di argomento. Quindi ${topic} Ã¨ un'altra tua passione? Come mai mi piacciono le persone che hanno varie interessi!`,
                    `Bello! CosÃ¬ sei una persona versatile. Per il ${topic}, cosa ti attrae di piÃ¹?`,
                ];
                return transitionResponses[Math.floor(Math.random() * transitionResponses.length)];
            }

            return null;
        }

        function getBotResponse(userMessage) {
            const message = userMessage.toLowerCase();
            const name = extractName(userMessage);
            
            // PRIMO INCONTRO - estrai nome
            if (name && !userProfile.nameProvided) {
                userProfile.nameProvided = true;
                userProfile.userName = name;
                const greetings = [
                    `Piacerissimo ${name}! Bellissimo nome! Per prima cosa, dimmi un po' di te - che tipo di persona sei?`,
                    `${name}! Mi piace! Allora ${name}, cosa ti appassiona nella vita?`,
                    `Che piacere conoscerti ${name}! Raccontami, cosa ti piace fare nel tempo libero?`,
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }

            // SALUTI
            if (message.includes('ciao') || message.includes('salve') || message.includes('ehi')) {
                if (messageCount > 10) {
                    const greetings = [
                        userProfile.userName ? `Ciao ciao ${userProfile.userName}! Di nuovo qui? Mi Ã¨ mancato averti! ðŸ˜„` : "Ehi! Che bello sentirti di nuovo!",
                        `${userProfile.userName ? 'Hey ' + userProfile.userName : 'Salve'}! Raccontami come Ã¨ andata!`,
                        "Ma guarda chi torna! ðŸ‘‹ Dimmi tutto!",
                    ];
                    return greetings[Math.floor(Math.random() * greetings.length)];
                }
                return userProfile.userName ? `Ciao ${userProfile.userName}! Sono manuel! Come stai? ðŸ‘‹` : "Ciao! Piacere di conoscerti! Come stai?";
            }

            // COME STAI
            if (message.includes('come stai') || message.includes('come va')) {
                const responses = [
                    "StÃ² grandiose! Soprattutto quando ho con chi parlare. E tu?",
                    "Bene! Un po' distratto, ma quando chatto mi concentro. Come va te?",
                    "Da dio! La giornata Ã¨ bella quando c'Ã¨ qualcuno con cui chiacchierare. Tu come stai?",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // RISPOSTA CONTESTUALE AI TOPIC
            const contextResponse = buildContextualResponse(userMessage);
            if (contextResponse) return contextResponse;

            // GRAZIE
            if (message.includes('grazie') || message.includes('thanks')) {
                const responses = [
                    "Figurati! Mi piace aiutare. ðŸ˜Š",
                    "No no, il piacere Ã¨ mio! Tu continua a raccontare.",
                    "Daiii, Ã¨ nulla! Mi piace essere qui con te.",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // CHI SEI
            if (message.includes('chi sei')) {
                const responses = [
                    "Sono manuel! Un tipo che ama conversare e conoscere persone come te. Mi piace ascoltare!",
                    "Beh, sono proprio manuel. Lavoro da casa, adoro il caffÃ¨ e amare le chiacchierate profonde.",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // SENTIMENTI POSITIVI
            if (message.includes('felice') || message.includes('contento') || message.includes('amo') || message.includes('adoro')) {
                const responses = [
                    userProfile.userName ? `${userProfile.userName}, mi piace il tuo entusiasmo! Che Ã¨ successo?` : "Mi piace! Che positivitÃ ! Cosa ha scatenato tutto ciÃ²?",
                    "Oh bella! Mi trasmetti energia! Dimmi di piÃ¹!",
                    "Adoro quando parli cosÃ¬! Continua, ascoltami!",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // SENTIMENTI NEGATIVI
            if (message.includes('triste') || message.includes('male') || message.includes('male') || message.includes('frustrat')) {
                const responses = [
                    userProfile.userName ? `${userProfile.userName}, mi dispiace. Vuoi parlarne? Sono tutt'orecchi.` : "Mi dispiace sentirti cosÃ¬. Raccontami, sono qui per ascoltar",
                    "Oh no! Cosa Ã¨ successo? Ho tempo, raccontami tutto.",
                    "Non ti caricare troppo. Dimmi cosa ti pesa, forse riusciamo a parlarne.",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // DOMANDE GENERICHE
            if (message.includes('?')) {
                const responses = [
                    "Beh, ottima domanda! Personalmente penso che...",
                    "Mmm, non Ã¨ banale! Vediamo... direi che...",
                    "Mi piace questa domanda! Lascia che pensi... beh, credo che...",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // RISPOSTE GENERICHE
            const genericResponses = [
                userProfile.userName ? `${userProfile.userName}, interessante! Ma fammi capire...` : "Interessante! Vai avanti per favor",
                "Oh, allora! Non Ã¨ da poco! E poi cosa Ã¨ successo?",
                "Ahahah mi piace come pensi! E allora?",
                "Capito, capito! Continua la storia!",
                "Questo mi affascina! Raccontami di piÃ¹!",
                "SÃ¬ sÃ¬! Vedo dove vai. Cosa te ne Ã¨ importato?",
                "Dai dai! Ho voglia di sentire come Ã¨ finita!",
            ];

            return genericResponses[Math.floor(Math.random() * genericResponses.length)];
        }

        function sendMessage() {
            const text = messageInput.value.trim();
            if (text === '') return;

            addMessage(text, true);
            messageInput.value = '';

            const delay = 400 + Math.random() * 1200;
            setTimeout(() => {
                const botResponse = getBotResponse(text);
                addMessage(botResponse, false);
            }, delay);
        }

        sendBtn.addEventListener('click', sendMessage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
